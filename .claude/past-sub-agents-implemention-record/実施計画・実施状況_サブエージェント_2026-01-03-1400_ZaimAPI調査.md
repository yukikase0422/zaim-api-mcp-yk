# Zaim API MCPサーバー エラー原因調査

## タスク概要

Claude DesktopでMCPサーバー `zaim-api` が「failed」状態になり、「Server disconnected」エラーが発生している問題の原因調査を行う。

## 目的

- エラーの根本原因を特定する
- 具体的な修正方法を提案する

## 調査手順

### 1. Claude Desktopログファイルの確認
- パス: `C:\Users\yukik\AppData\Roaming\Claude\logs`
- 最新のログファイルからzaim-apiに関連するエラーを特定

### 2. ビルド成果物の確認
- `dist/index.js` の存在確認
- `dist/` ディレクトリの内容確認

### 3. MCPサーバーの直接起動テスト
- プロジェクトディレクトリ: `d:\UserFolders\yukik\Desktop\_自作アプリ\4_Web・SNS連携\ZaimMCP`
- 環境変数設定とnode実行
- エラーメッセージの収集

## 制約事項

- 機密情報（APIキー等）は調査に使用するが、報告時には伏せる
- 具体的なエラーメッセージを必ず記録する

## 進行状況

- [x] 実施計画・実施状況ファイル作成
- [x] ToDoリスト作成
- [x] Claude Desktopログファイルの確認
- [x] ビルド成果物の確認
- [x] MCPサーバー直接起動テスト
- [x] エラー原因の特定
- [x] 修正方法の提案
- [x] 報告書作成

## 調査結果サマリー

### エラー原因
`src/index.ts` の77行目の条件式が常に `false` になり、`main()` 関数が実行されないため、サーバーが起動しない。

### 条件式が false になる理由
1. スラッシュの数の違い（`file:///` vs `file://`）
2. URLエンコーディングの違い（日本語文字）
3. パス区切り文字の違い（`/` vs `\`）

### 推奨修正方法
条件式を削除して、常に `main()` を実行するように変更。

```typescript
// 修正前（77-82行目）
if (import.meta.url === `file://${process.argv[1]}`) {
  main().catch((error) => {
    console.error('Fatal error:', error);
    process.exit(1);
  });
}

// 修正後
main().catch((error) => {
  console.error('Fatal error:', error);
  process.exit(1);
});
```

## 成果物
- 詳細調査報告書: `.claude/調査報告_ZaimAPI_MCPサーバーエラー.md`
